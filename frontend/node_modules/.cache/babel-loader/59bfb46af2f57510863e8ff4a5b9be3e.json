{"ast":null,"code":"import _regeneratorRuntime from\"/Applications/MAMP/htdocs/ecomreact/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Applications/MAMP/htdocs/ecomreact/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Applications/MAMP/htdocs/ecomreact/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Button,Col,Row,ListGroup,Image,Card}from\"react-bootstrap\";import{useDispatch,useSelector}from\"react-redux\";import{deliverOrder,getOrderDetails,payOrder}from\"../actions/orderActions\";import Message from\"../components/Message\";import Loader from\"../components/Loader\";import{Link}from\"react-router-dom\";import axios from\"axios\";import{PayPalButton}from\"react-paypal-button-v2\";import{ORDER_DELIVER_RESET,ORDER_PAY_RESET}from\"../constants/orderContstants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderScreen=function OrderScreen(_ref){var history=_ref.history,match=_ref.match;var orderId=match.params.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var dispatch=useDispatch();var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var addDecimal=function addDecimal(num){return(Math.round(num*100)/100).toFixed(2);};if(!loading){order.itemsPrice=addDecimal(order.orderItems.reduce(function(acc,item){return acc+item.price*item.qty;},0));order.shippingPrice=addDecimal(order.itemsPrice>100?0:100);order.taxPrice=addDecimal(Number((0.15*order.itemsPrice).toFixed(2)));}useEffect(function(){if(!userInfo){history.push(\"/login\");}var addPaypalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/api/config/paypal\");case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement(\"script\");console.log(clientId);script.type=\"text/javascript\";script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 11:case\"end\":return _context.stop();}}},_callee);}));return function addPaypalScript(){return _ref2.apply(this,arguments);};}();if(!order||successPay||successDeliver){dispatch({type:ORDER_PAY_RESET});dispatch({type:ORDER_DELIVER_RESET});dispatch(getOrderDetails(orderId));}else if(!order.isPaid){if(!window.paypal){addPaypalScript();}else{setSdkReady(true);}}},[successPay,orderId,dispatch,order,successDeliver]);var successPaymentHandler=function successPaymentHandler(paymentResult){console.log(paymentResult);dispatch(payOrder(orderId,paymentResult));};var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};return loading?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Order \",order._id]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:8,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",order.user.name,\" \"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),/*#__PURE__*/_jsxs(\"a\",{href:\"mailto:\".concat(order.user.email),children:[\" \",order.user.email]})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address\"}),order.shippingAddress.address,\", \",order.shippingAddress.postalCode,\", ,\",\" \",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\" Delivered On \",order.deliveredAt]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\" Not Delivered \"})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method: \"}),order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\"Paid On \",order.paidAt]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\" Not paid\"})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),order.orderItems.length===0?/*#__PURE__*/_jsx(Message,{children:\"Your Cart is empty\"}):/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product),children:item.name})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[item.qty,\" x \\u20B9\",item.price,\" = \\u20B9\",item.price*item.qty]})]})},index);})})]})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"fluid\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.itemsPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Tax\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.taxPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Total\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.totalPrice]})]})}),!order.isPaid&&/*#__PURE__*/_jsxs(ListGroup.Item,{children:[loadingPay&&/*#__PURE__*/_jsx(Loader,{}),!sdkReady?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler})]}),loadingDeliver&&/*#__PURE__*/_jsx(Loader,{}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"button\",className:\"btn btn-block\",onClick:deliverHandler,children:\"Mark as Delivered\"})})]})})})]})]});};export default OrderScreen;","map":{"version":3,"sources":["/Applications/MAMP/htdocs/ecomreact/frontend/src/screens/OrderScreen.js"],"names":["React","useState","useEffect","Button","Col","Row","ListGroup","Image","Card","useDispatch","useSelector","deliverOrder","getOrderDetails","payOrder","Message","Loader","Link","axios","PayPalButton","ORDER_DELIVER_RESET","ORDER_PAY_RESET","OrderScreen","history","match","orderId","params","id","sdkReady","setSdkReady","dispatch","orderDetails","state","order","loading","error","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","userLogin","userInfo","addDecimal","num","Math","round","toFixed","itemsPrice","orderItems","reduce","acc","item","price","qty","shippingPrice","taxPrice","Number","push","addPaypalScript","get","clientId","data","script","document","createElement","console","log","type","src","async","onload","body","appendChild","isPaid","window","paypal","successPaymentHandler","paymentResult","deliverHandler","_id","user","name","email","shippingAddress","address","postalCode","country","isDelivered","deliveredAt","paymentMethod","paidAt","length","map","index","image","product","totalPrice","isAdmin"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Button, Col, Row, ListGroup, Image, Card } from \"react-bootstrap\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { deliverOrder, getOrderDetails, payOrder } from \"../actions/orderActions\";\nimport Message from \"../components/Message\";\nimport Loader from \"../components/Loader\";\nimport { Link } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { PayPalButton } from \"react-paypal-button-v2\";\nimport { ORDER_DELIVER_RESET, ORDER_PAY_RESET } from \"../constants/orderContstants\";\n\nconst OrderScreen = ({ history, match }) => {\n  const orderId = match.params.id;\n  const [sdkReady, setSdkReady] = useState(false);\n  const dispatch = useDispatch();\n\n  const orderDetails = useSelector((state) => state.orderDetails);\n  const { order, loading, error } = orderDetails;\n\n  const orderPay = useSelector((state) => state.orderPay);\n  const { loading: loadingPay, success: successPay } = orderPay;\n\n  const orderDeliver = useSelector((state) => state.orderDeliver);\n  const { loading: loadingDeliver, success: successDeliver } = orderDeliver;\n\n  const userLogin = useSelector((state) => state.userLogin);\n  const { userInfo } = userLogin;\n\n  const addDecimal = (num) => {\n    return (Math.round(num * 100) / 100).toFixed(2);\n  };\n\n  if (!loading) {\n    order.itemsPrice = addDecimal(\n      order.orderItems.reduce((acc, item) => acc + item.price * item.qty, 0)\n    );\n\n    order.shippingPrice = addDecimal(order.itemsPrice > 100 ? 0 : 100);\n    order.taxPrice = addDecimal(Number((0.15 * order.itemsPrice).toFixed(2)));\n  }\n\n  useEffect(() => {\n    if (!userInfo) {\n      history.push(\"/login\");\n    }\n\n    const addPaypalScript = async () => {\n      const { data: clientId } = await axios.get(\"/api/config/paypal\");\n      const script = document.createElement(\"script\");\n      console.log(clientId);\n      script.type = \"text/javascript\";\n      script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`;\n      script.async = true;\n      script.onload = () => {\n        setSdkReady(true);\n      };\n      document.body.appendChild(script);\n    };\n\n    if (!order || successPay || successDeliver) {\n      dispatch({ type: ORDER_PAY_RESET });\n      dispatch({ type: ORDER_DELIVER_RESET });\n      dispatch(getOrderDetails(orderId));\n    } else if (!order.isPaid) {\n      if (!window.paypal) {\n        addPaypalScript();\n      } else {\n        setSdkReady(true);\n      }\n    }\n  }, [successPay, orderId, dispatch, order, successDeliver]);\n\n  const successPaymentHandler = (paymentResult) => {\n    console.log(paymentResult);\n    dispatch(payOrder(orderId, paymentResult));\n  };\n\n  const deliverHandler = () => {\n    dispatch(deliverOrder(order));\n  };\n\n  return loading ? (\n    <Loader />\n  ) : error ? (\n    <Message>{error}</Message>\n  ) : (\n    <>\n      <h1>Order {order._id}</h1>\n      <Row>\n        <Col md={8}>\n          <ListGroup variant=\"flush\">\n            <ListGroup.Item>\n              <h2>Shipping</h2>\n              <p>\n                <strong>Name:</strong> {order.user.name}{\" \"}\n              </p>\n              <p>\n                <strong>Email:</strong>\n                <a href={`mailto:${order.user.email}`}> {order.user.email}</a>\n              </p>\n              <p>\n                <strong>Address</strong>\n                {order.shippingAddress.address}, {order.shippingAddress.postalCode}, ,{\" \"}\n                {order.shippingAddress.country}\n              </p>\n              {order.isDelivered ? (\n                <Message variant=\"success\"> Delivered On {order.deliveredAt}</Message>\n              ) : (\n                <Message variant=\"danger\"> Not Delivered </Message>\n              )}\n            </ListGroup.Item>\n\n            <ListGroup.Item>\n              <h2>Payment Method</h2>\n              <p>\n                <strong>Method: </strong>\n                {order.paymentMethod}\n              </p>\n              {order.isPaid ? (\n                <Message variant=\"success\">Paid On {order.paidAt}</Message>\n              ) : (\n                <Message variant=\"danger\"> Not paid</Message>\n              )}\n            </ListGroup.Item>\n\n            <ListGroup.Item>\n              <h2>Order Items</h2>\n              {order.orderItems.length === 0 ? (\n                <Message>Your Cart is empty</Message>\n              ) : (\n                <ListGroup variant=\"flush\">\n                  {order.orderItems.map((item, index) => (\n                    <ListGroup.Item key={index}>\n                      <Row>\n                        <Col md={1}>\n                          <Image src={item.image} alt={item.name} fluid rounded />\n                        </Col>\n                        <Col>\n                          <Link to={`/product/${item.product}`}>{item.name}</Link>\n                        </Col>\n                        <Col md={4}>\n                          {item.qty} x &#x20b9;{item.price} = &#x20b9;{item.price * item.qty}\n                        </Col>\n                      </Row>\n                    </ListGroup.Item>\n                  ))}\n                </ListGroup>\n              )}\n            </ListGroup.Item>\n          </ListGroup>\n        </Col>\n        <Col md={4}>\n          <Card>\n            <ListGroup variant=\"fluid\">\n              <ListGroup.Item>\n                <h2>Order Summary</h2>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col>Items</Col>\n                  <Col>&#x20b9;{order.itemsPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col>Shipping</Col>\n                  <Col>&#x20b9;{order.shippingPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col>Tax</Col>\n                  <Col>&#x20b9;{order.taxPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col>Total</Col>\n                  <Col>&#x20b9;{order.totalPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              {!order.isPaid && (\n                <ListGroup.Item>\n                  {loadingPay && <Loader />}\n                  {!sdkReady ? (\n                    <Loader />\n                  ) : (\n                    <PayPalButton amount={order.totalPrice} onSuccess={successPaymentHandler} />\n                  )}\n                </ListGroup.Item>\n              )}\n              {loadingDeliver && <Loader />}\n              {userInfo && userInfo.isAdmin && order.isPaid && !order.isDelivered && (\n                <ListGroup.Item>\n                  <Button type=\"button\" className=\"btn btn-block\" onClick={deliverHandler}>\n                    Mark as Delivered\n                  </Button>\n                </ListGroup.Item>\n              )}\n            </ListGroup>\n          </Card>\n        </Col>\n      </Row>\n    </>\n  );\n};\n\nexport default OrderScreen;\n"]},"metadata":{},"sourceType":"module"}